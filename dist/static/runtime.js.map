{"version":3,"file":"runtime.js","sources":["../../node_modules/hono/dist/jsx/dom/components.js","../../node_modules/honox/dist/client/runtime.js"],"sourcesContent":["// src/jsx/dom/components.ts\nimport { DOM_ERROR_HANDLER } from \"../constants.js\";\nimport { Fragment } from \"./jsx-runtime.js\";\nvar ErrorBoundary = ({ children, fallback, fallbackRender, onError }) => {\n  const res = Fragment({ children });\n  res[DOM_ERROR_HANDLER] = (err) => {\n    if (err instanceof Promise) {\n      throw err;\n    }\n    onError?.(err);\n    return fallbackRender?.(err) || fallback;\n  };\n  return res;\n};\nvar Suspense = ({\n  children,\n  fallback\n}) => {\n  const res = Fragment({ children });\n  res[DOM_ERROR_HANDLER] = (err, retry) => {\n    if (!(err instanceof Promise)) {\n      throw err;\n    }\n    err.finally(retry);\n    return fallback;\n  };\n  return res;\n};\nexport {\n  ErrorBoundary,\n  Suspense\n};\n","import { Suspense, use } from \"hono/jsx/dom\";\nimport { COMPONENT_NAME, DATA_HONO_TEMPLATE, DATA_SERIALIZED_PROPS } from \"../constants.js\";\nconst buildCreateChildrenFn = (createElement, importComponent) => {\n  let keyIndex = 0;\n  const setChildrenFromTemplate = async (props, element) => {\n    const maybeTemplate = element.childNodes[element.childNodes.length - 1];\n    if (maybeTemplate?.nodeName === \"TEMPLATE\" && maybeTemplate?.getAttribute(DATA_HONO_TEMPLATE) !== null) {\n      props.children = await createChildren(\n        maybeTemplate.content.childNodes\n      );\n    }\n  };\n  const createElementFromHTMLElement = async (element) => {\n    const props = {\n      children: await createChildren(element.childNodes)\n    };\n    const attributes = element.attributes;\n    for (let i = 0; i < attributes.length; i++) {\n      props[attributes[i].name] = attributes[i].value;\n    }\n    return createElement(element.nodeName, {\n      key: ++keyIndex,\n      ...props\n    });\n  };\n  const createChildren = async (childNodes) => {\n    const children = [];\n    for (let i = 0; i < childNodes.length; i++) {\n      const child = childNodes[i];\n      if (child.nodeType === 8) {\n        continue;\n      } else if (child.nodeType === 3) {\n        children.push(child.textContent);\n      } else if (child.nodeName === \"TEMPLATE\" && child.id.match(/(?:H|E):\\d+/)) {\n        const placeholderElement = document.createElement(\"hono-placeholder\");\n        placeholderElement.style.display = \"none\";\n        let resolve;\n        const promise = new Promise((r) => resolve = r);\n        child.replaceWith = (node) => {\n          createChildren(node.childNodes).then(resolve);\n          placeholderElement.remove();\n        };\n        let fallback = [];\n        for (\n          // equivalent to i++\n          placeholderElement.appendChild(child);\n          i < childNodes.length;\n          i++\n        ) {\n          const child2 = childNodes[i];\n          if (child2.nodeType === 8) {\n            placeholderElement.appendChild(child2);\n            i--;\n            break;\n          } else if (child2.nodeType === 3) {\n            fallback.push(child2.textContent);\n          } else {\n            fallback.push(await createElementFromHTMLElement(child2));\n          }\n        }\n        const fallbackTemplates = document.querySelectorAll(\n          `[data-hono-target=\"${child.id}\"]`\n        );\n        if (fallbackTemplates.length > 0) {\n          const fallbackTemplate = fallbackTemplates[fallbackTemplates.length - 1];\n          fallback = await createChildren(fallbackTemplate.content.childNodes);\n        }\n        if (fallback.length === 0 && child.id.startsWith(\"E:\")) {\n          let resolve2;\n          const promise2 = new Promise((r) => resolve2 = r);\n          fallback = await createElement(Suspense, {\n            fallback: [],\n            children: [await createElement(() => use(promise2), {})]\n          });\n          placeholderElement.insertBefore = (node) => {\n            createChildren(node.childNodes).then(resolve2);\n          };\n        }\n        document.body.appendChild(placeholderElement);\n        children.push(\n          await createElement(Suspense, {\n            fallback,\n            children: [await createElement(() => use(promise), {})]\n          })\n        );\n      } else {\n        let component = void 0;\n        const componentName = child.getAttribute(COMPONENT_NAME);\n        if (componentName) {\n          component = await importComponent(componentName);\n        }\n        if (component) {\n          const props = JSON.parse(child.getAttribute(DATA_SERIALIZED_PROPS) || \"{}\");\n          await setChildrenFromTemplate(props, child);\n          children.push(\n            await createElement(component, {\n              key: ++keyIndex,\n              ...props\n            })\n          );\n        } else {\n          children.push(await createElementFromHTMLElement(child));\n        }\n      }\n    }\n    return children;\n  };\n  return createChildren;\n};\nconst hydrateComponentHonoSuspense = async (hydrateComponent) => {\n  const templates = /* @__PURE__ */ new Set();\n  const observerTargets = /* @__PURE__ */ new Set();\n  document.querySelectorAll('template[id^=\"H:\"], template[id^=\"E:\"]').forEach((template) => {\n    if (template.parentElement) {\n      templates.add(template);\n      observerTargets.add(template.parentElement);\n    }\n  });\n  if (observerTargets.size === 0) {\n    return;\n  }\n  const observer = new MutationObserver((mutations) => {\n    const targets = /* @__PURE__ */ new Set();\n    mutations.forEach((mutation) => {\n      if (mutation.target instanceof Element) {\n        targets.add(mutation.target);\n        mutation.removedNodes.forEach((node) => {\n          templates.delete(node);\n        });\n      }\n    });\n    targets.forEach((target) => {\n      hydrateComponent(target);\n    });\n    if (templates.size === 0) {\n      observer.disconnect();\n    }\n  });\n  observerTargets.forEach((target) => {\n    observer.observe(target, { childList: true });\n  });\n};\nexport {\n  buildCreateChildrenFn,\n  hydrateComponentHonoSuspense\n};\n"],"names":["Suspense","children","fallback","res","Fragment","DOM_ERROR_HANDLER","err","retry","buildCreateChildrenFn","createElement","importComponent","keyIndex","setChildrenFromTemplate","props","element","maybeTemplate","DATA_HONO_TEMPLATE","createChildren","createElementFromHTMLElement","attributes","i","childNodes","child","placeholderElement","resolve","promise","r","node","child2","fallbackTemplates","fallbackTemplate","resolve2","promise2","use","component","componentName","COMPONENT_NAME","DATA_SERIALIZED_PROPS","hydrateComponentHonoSuspense","hydrateComponent","templates","observerTargets","template","observer","mutations","targets","mutation","target"],"mappings":"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","x_google_ignoreList":[0,1]}